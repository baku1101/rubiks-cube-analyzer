# デバッグガイド

## Web版テスト手順

### 1. 開発環境の準備

必要なツール:
- Chrome (最新版)
- Flutter SDK
- Visual Studio Code

### 2. アプリケーションの実行

```bash
# リポジトリのルートディレクトリで実行
scripts/run_web_local.bat
```

### 3. デバッグツールの使用

1. Chrome DevToolsを開く (F12)
2. Consoleタブでブラウザの対応状況を確認
3. アプリ内のデバッグパネルで通信ログを確認

### 4. テスト手順

1. Bluetooth接続テスト:
   - 「接続」ボタンをクリック
   - デバイス選択ダイアログが表示されることを確認
   - GAN i3キューブが検出されることを確認

2. キューブ状態の取得:
   - 接続成功後、キューブの状態が更新されることを確認
   - デバッグパネルでデータの受信を確認

3. 暗号化/復号化のテスト:
   - デバッグパネルで暗号化されたデータと復号化されたデータを確認
   - データ形式が正しいことを確認

### 5. 既知の制限事項

1. Web Bluetooth APIの制限:
   - HTTPSまたはlocalhostでのみ動作
   - ユーザーのアクション（クリックなど）が必要
   - 一部のBluetoothデバイスで接続が不安定な場合あり

2. ブラウザの制限:
   - Chrome/Edge以外のブラウザでは動作しない
   - プライベートブラウジングモードでは動作しない

### 6. トラブルシューティング

1. 接続エラーが発生する場合:
   - ブラウザのバージョンを確認
   - `chrome://bluetooth-internals/` でデバイスの状態を確認
   - デバイスのペアリングを解除して再試行

2. データの受信に問題がある場合:
   - デバッグパネルのログを確認
   - Chrome DevToolsのConsoleでエラーを確認
   - キューブの電池残量を確認

### 7. デバッグログの見方

デバッグパネルには以下の情報が表示されます：

- BLEデバイスの検出情報
- サービスとキャラクタリスティックの探索結果
- データの送受信ログ
- 暗号化/復号化の状態

色分けされたログの意味：
- 青: 情報ログ
- 緑: 成功
- 黄: 警告
- 赤: エラー

### 8. テスト時の注意点

1. パフォーマンス:
   - 複数のBLEデバイスが近くにある場合、スキャンに時間がかかる
   - デバッグログが多すぎると動作が遅くなる可能性あり

2. セキュリティ:
   - 自己署名証明書使用時は警告が表示される
   - Bluetooth権限の要求が必要

3. データ保護:
   - キューブの状態データは暗号化されて送信
   - キーの生成にはデバイスIDを使用

### 9. バグ報告

バグを発見した場合は、以下の情報を含めて報告してください：

1. 環境情報:
   - Chromeのバージョン
   - OSのバージョン
   - キューブのファームウェアバージョン

2. 再現手順:
   - 具体的な操作手順
   - エラーメッセージ
   - デバッグパネルのログ

3. 期待される動作:
   - 本来どのように動作するべきか
   - 現在の動作との違い